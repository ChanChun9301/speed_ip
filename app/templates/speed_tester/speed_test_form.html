{% extends "layouts.html" %}
{% load static %}

{% block content %}
<div class="min-h-screen flex items-center justify-center px-6 py-24">
    <div class="w-full max-w-3xl">

        <div class="glass rounded-3xl p-10 md:p-16 shadow-2xl border border-white/10 neon-glow">

            <!-- Заголовок -->
            <div class="text-center mb-14">
                <h1 class="text-6xl md:text-8xl font-black text-gradient tracking-tight leading-tight">
                    IP Tizligi Synagy
                </h1>
                <p class="mt-6 text-2xl text-gray-300 max-w-2xl mx-auto">
                    Her bir IP salgysyna ýa-da domena gönüden-göne tizlik we jogap wagtyny barlaň
                </p>
            </div>

            <!-- Форма -->
            <form method="post" class="space-y-12">
                {% csrf_token %}

                <div>
                    <div class="flex items-center gap-6 p-8 bg-black/40 rounded-3xl border border-white/20 focus-within:border-[#92DEB5]/70 focus-within:ring-4 focus-within:ring-[#92DEB5]/20 transition-all duration-400">
                        <i class="fas fa-server text-5xl text-[#92DEB5] opacity-80"></i>
                        <div class="flex-1">
                            <!-- Явно рендерим как input type="text" -->
                            <input type="text"
                                   name="ip_address"
                                   id="id_ip_address"
                                   value="{{ form.ip_address.value|default:'' }}"
                                   placeholder="8.8.8.8 ýa-da google.com"
                                   required
                                   class="w-full bg-transparent text-2xl text-white placeholder-gray-500 focus:outline-none">

                            <label for="id_ip_address" class="block mt-3 text-gray-400 text-lg font-medium">
                                IP salgysyny ýa-da domeni giriziň 
                                <span class="text-gray-500">(mysal: 8.8.8.8 ýa-da google.com)</span>
                            </label>
                        </div>
                    </div>

                    <!-- Ошибки формы -->
                    {% if form.ip_address.errors %}
                        <div class="mt-6 p-6 bg-red-500/10 border border-red-500/40 rounded-2xl text-red-400 text-center backdrop-blur">
                            <i class="fas fa-exclamation-triangle text-2xl mr-3"></i>
                            {{ form.ip_address.errors|join:"<br>" }}
                        </div>
                    {% endif %}
                </div>

                <!-- Кнопка запуска -->
                <div class="text-center">
                    <button type="submit" class="group inline-flex items-center gap-6 px-20 py-8 bg-gradient-to-r from-[#92DEB5] to-[#6ab88a] text-black font-black text-3xl rounded-full shadow-2xl hover:scale-110 hover:shadow-[#92DEB5]/80 transition-all duration-500">
                        <i class="fas fa-play text-4xl group-hover:translate-x-3 transition-transform"></i>
                        Synagy Başlatmak
                    </button>
                </div>
            </form>

            <!-- Остальное (индикатор, результаты и т.д.) — без изменений -->
            {% if testing %}
            <div class="mt-16 text-center">
                <div class="inline-flex items-center gap-5 px-10 py-6 bg-black/50 rounded-full border-2 border-[#92DEB5]/50 backdrop-blur">
                    <div class="w-5 h-5 bg-[#92DEB5] rounded-full animate-ping"></div>
                    <div class="w-5 h-5 bg-[#92DEB5] rounded-full animate-pulse"></div>
                    <div class="w-5 h-5 bg-[#92DEB5] rounded-full animate-ping"></div>
                    <span class="ml-4 text-2xl text-[#92DEB5] font-bold">Synag dowam edýär...</span>
                </div>
            </div>
            {% endif %}

            {% if result %}
            <div class="mt-20 p-12 bg-black/50 rounded-3xl border-2 border-[#92DEB5]/40 neon-glow space-y-10">
                <h2 class="text-5xl font-black text-center text-gradient">Synag Netijesi</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-10 text-center">
                    <div class="p-10 bg-white/5 rounded-2xl border border-white/10">
                        <i class="fas fa-stopwatch text-7xl text-[#92DEB5] mb-6 opacity-90"></i>
                        <p class="text-gray-400 text-xl">Jogap wagty</p>
                        <p class="text-6xl font-black text-white mt-4">
                            {% if result.ping_ms == -1 %}
                                <span class="text-red-400">Wagt gutardy</span>
                            {% elif result.ping_ms < 100 %}
                                <span class="text-green-400">{{ result.ping_ms|floatformat:1 }} ms</span>
                            {% elif result.ping_ms < 300 %}
                                <span class="text-yellow-400">{{ result.ping_ms|floatformat:1 }} ms</span>
                            {% else %}
                                <span class="text-red-400">{{ result.ping_ms|floatformat:1 }} ms</span>
                            {% endif %}
                        </p>
                    </div>

                    <div class="p-10 bg-white/5 rounded-2xl border border-white/10">
                        <i class="fas fa-tachometer-alt text-7xl text-[#92DEB5] mb-6 opacity-90"></i>
                        <p class="text-gray-400 text-xl">Orta tizlik</p>
                        <p class="text-6xl font-black text-white mt-4">
                            {% widthratio result.avg_speed_kbps|default:0 1000 1 as mbps %}
                            {% if result.avg_speed_kbps > 1000 %}
                                <span class="text-[#92DEB5]">{{ mbps|floatformat:2 }} Mbps</span>
                            {% else %}
                                <span class="text-[#92DEB5]">{{ result.avg_speed_kbps|floatformat:0 }} kbps</span>
                            {% endif %}
                        </p>
                    </div>
                </div>

                <div class="text-center mt-8">
                    <p class="text-gray-400 text-lg mb-3">Barlanan IP / Domen:</p>
                    <code class="text-3xl font-mono text-[#92DEB5] bg-black/60 px-10 py-5 rounded-2xl border border-[#92DEB5]/40 inline-block">
                        {{ result.target_ip }}
                    </code>
                </div>
            </div>
            {% endif %}

            <div class="text-center mt-16">
                <a href="{% url 'home' %}" class="inline-flex items-center gap-4 px-10 py-5 glass border border-white/20 rounded-2xl text-xl font-medium hover:border-[#92DEB5]/60 hover:bg-white/10 transition-all duration-400 hover:scale-105">
                    <i class="fas fa-home text-[#92DEB5]"></i>
                    Baş sahypa
                </a>
            </div>

        </div>
    </div>
</div>
{% endblock %}